#include "snake.h"

void draw_pio(const double* frame, PIO pio, uint sm);

/* Definicao de constantes*/

const double snake_frames[SNAKE_NUM_FRAMES][MTX_NUM_LEDS] = {
    {0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0, 
     0.0, 0.3, 0.3, 0.3, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0},
                         
    {0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.3, 0.0, 
     0.0, 0.0, 0.3, 0.3, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0},

    {0.0, 0.0, 0.0, 0.3, 0.0,
     0.0, 0.0, 0.0, 0.3, 0.0, 
     0.0, 0.0, 0.0, 0.3, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0},

    {0.0, 0.0, 0.3, 0.3, 0.0,
     0.0, 0.0, 0.0, 0.3, 0.0, 
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0},
          
    {0.0, 0.3, 0.3, 0.3, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0, 
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0},

    {0.0, 0.3, 0.3, 0.0, 0.0,
     0.0, 0.3, 0.0, 0.0, 0.0, 
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0},

    {0.0, 0.3, 0.0, 0.0, 0.0,
     0.0, 0.3, 0.0, 0.0, 0.0, 
     0.0, 0.3, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0},

    {0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.3, 0.0, 0.0, 0.0, 
     0.0, 0.3, 0.0, 0.0, 0.0,
     0.0, 0.3, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0},

    {0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0, 
     0.0, 0.3, 0.0, 0.0, 0.0,
     0.3, 0.3, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0},

    {0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0, 
     0.3, 0.0, 0.0, 0.0, 0.0,
     0.3, 0.3, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0},

    {0.0, 0.0, 0.0, 0.0, 0.0,
     0.3, 0.0, 0.0, 0.0, 0.0, 
     0.3, 0.0, 0.0, 0.0, 0.0,
     0.3, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0},

    {0.3, 0.0, 0.0, 0.0, 0.0,
     0.3, 0.0, 0.0, 0.0, 0.0, 
     0.3, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0},

    {0.3, 0.3, 0.0, 0.0, 0.0,
     0.3, 0.0, 0.0, 0.0, 0.0, 
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0},

    {0.3, 0.3, 0.3, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0, 
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0},

    {0.0, 0.3, 0.3, 0.3, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0, 
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0},

    {0.0, 0.0, 0.3, 0.3, 0.3,
     0.0, 0.0, 0.0, 0.0, 0.0, 
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0},

    {0.0, 0.0, 0.0, 0.3, 0.3,
     0.0, 0.0, 0.0, 0.0, 0.3, 
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0},

    {0.0, 0.0, 0.0, 0.0, 0.3,
     0.0, 0.0, 0.0, 0.3, 0.3, 
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0},

    {0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.3, 0.3, 
     0.0, 0.0, 0.0, 0.3, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0},

    {0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.3, 0.0, 
     0.0, 0.0, 0.0, 0.3, 0.0,
     0.0, 0.0, 0.0, 0.3, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0},

    {0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0, 
     0.0, 0.0, 0.0, 0.3, 0.0,
     0.0, 0.0, 0.0, 0.3, 0.3,
     0.0, 0.0, 0.0, 0.0, 0.0},

    {0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0, 
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.3, 0.3,
     0.0, 0.0, 0.0, 0.0, 0.3},

    {0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0, 
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.3,
     0.0, 0.0, 0.0, 0.3, 0.3},

    {0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0, 
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.3, 0.3, 0.3},

    {0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0, 
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.3, 0.3, 0.3, 0.0},

    {0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0, 
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.3, 0.0, 0.0, 0.0,
     0.0, 0.3, 0.3, 0.0, 0.0},

    {0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0, 
     0.0, 0.3, 0.0, 0.0, 0.0,
     0.0, 0.3, 0.0, 0.0, 0.0,
     0.0, 0.3, 0.0, 0.0, 0.0},

    {0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0, 
     0.0, 0.3, 0.3, 0.0, 0.0,
     0.0, 0.3, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0},

    {0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0, 
     0.0, 0.3, 0.3, 0.3, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0,
     0.0, 0.0, 0.0, 0.0, 0.0}
};


void snake_animation(PIO pio, uint sm){
    for (int frame = 0; frame < SNAKE_NUM_FRAMES; frame++) {
        draw_pio(snake_frames[frame], pio, sm);
        sleep_ms(150); // Intervalo entre quadros
    }
}


/* 
* @brief Funcao para mapear os leds da matriz
*/

int map_led_index(int row, int col, int width) {
    if (row % 2 == 0) {
        // Linha par (esquerda para direita)
        return row * width + col;
    } else {
        // Linha Ã­mpar (direita para esquerda)
        return row * width + (width - 1 - col);
    }
}


/*
* @brief Rotina para acionar a matrix de leds - ws2812b
*/
void draw_pio(const double* frame, PIO pio, uint sm) {
    uint32_t led_value;

    for (int row = 0; row < MTX_NUM_ROWS; row++) {
        for (int col = 0; col < MTX_NUM_ROWS; col++) {
            int led_index = map_led_index(row, col, 5);
            led_value = matrix_rgb(frame[led_index], 0.0, 0.0);
            pio_sm_put_blocking(pio, sm, led_value); 
        }
    }
}


