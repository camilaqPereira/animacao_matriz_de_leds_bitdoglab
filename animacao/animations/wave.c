#include "wave.h"



const double wave_frames[WAVE_FRAMES_SIZE][MTX_NUM_LEDS] = {
     {0.3, 0.0, 0.0, 0.0, 0.0,  //
     0.0, 0.0, 0.0, 0.0, 0.0,  //
     0.0, 0.0, 0.0, 0.0, 0.0,  //
     0.0, 0.0, 0.0, 0.0, 0.0,  //
     0.0, 0.0, 0.0, 0.0, 0.0},

     {0.3, 0.0, 0.0, 0.0, 0.0,  //
     0.3, 0.0, 0.0, 0.0, 0.0,  //
     0.3, 0.0, 0.0, 0.0, 0.0,  //
     0.0, 0.0, 0.0, 0.0, 0.0,  //
     0.0, 0.0, 0.0, 0.0, 0.0},

    {0.3, 0.0, 0.0, 0.0, 0.0,  //
     0.3, 0.0, 0.0, 0.0, 0.0,  //
     0.3, 0.3, 0.0, 0.0, 0.0,  //
     0.0, 0.0, 0.0, 0.0, 0.0,  //
     0.0, 0.0, 0.0, 0.0, 0.0},

     {0.3, 0.0, 0.0, 0.0, 0.0,  //
     0.3, 0.3, 0.0, 0.0, 0.0,  //
     0.3, 0.3, 0.0, 0.0, 0.0,  //
     0.0, 0.0, 0.0, 0.0, 0.0,  //
     0.0, 0.0, 0.0, 0.0, 0.0},

    {0.3, 0.3, 0.0, 0.0, 0.0,  //
     0.3, 0.3, 0.0, 0.0, 0.0,  //
     0.3, 0.3, 0.0, 0.0, 0.0,  //
     0.0, 0.0, 0.0, 0.0, 0.0,  //
     0.0, 0.0, 0.0, 0.0, 0.0},

     {0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.3, 0.3, 0.0, 0.0, 0.0,  //
     0.3, 0.3, 0.0, 0.0, 0.0,  //
     0.0, 0.0, 0.0, 0.0, 0.0,  //
     0.0, 0.0, 0.0, 0.0, 0.0},

     {0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.3, 0.3, 0.0, 0.0, 0.0,  //
     0.0, 0.0, 0.0, 0.0, 0.0,  //
     0.0, 0.0, 0.0, 0.0, 0.0},

     {0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.0, 0.0, 0.0, 0.0, 0.0,  //
     0.0, 0.0, 0.0, 0.0, 0.0},

     {0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.0, 0.0, 0.3, 0.0, 0.0,  //
     0.0, 0.0, 0.0, 0.0, 0.0},

     {0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.0, 0.0, 0.3, 0.0, 0.0,  //
     0.0, 0.0, 0.3, 0.0, 0.0},

     {0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.0, 0.0, 0.3, 0.0, 0.0,  //
     0.0, 0.0, 0.3, 0.3, 0.0},

     {0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.0, 0.0, 0.3, 0.3, 0.0,  //
     0.0, 0.0, 0.3, 0.3, 0.0},

     {0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.3, 0.3, 0.3, 0.3, 0.0,  //
     0.0, 0.0, 0.3, 0.3, 0.0,  //
     0.0, 0.0, 0.3, 0.3, 0.0},

     {0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.3, 0.3, 0.3, 0.3, 0.3,  //
     0.0, 0.0, 0.3, 0.3, 0.0,  //
     0.0, 0.0, 0.3, 0.3, 0.0},

     {0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.3, 0.3, 0.3, 0.3, 0.3,  //
     0.0, 0.0, 0.3, 0.3, 0.3,  //
     0.0, 0.0, 0.3, 0.3, 0.0},

    {0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.3, 0.3, 0.3, 0.0, 0.0,  //
     0.3, 0.3, 0.3, 0.3, 0.3,  //
     0.0, 0.0, 0.3, 0.3, 0.3,  //
     0.0, 0.0, 0.3, 0.3, 0.3},

};


void wave_animation(PIO pio, uint sm) {
  for (int i = 0; i < WAVE_FRAMES_SIZE; i++) {  // Exibe todos os frames
    if (i == 0) buzzer_play(1, 1000, 500);

    draw_matrix(pio, sm, wave_frames[i], i);
    sleep_ms(100);  // Intervalo entre os frames   
  }
}

void draw_matrix(PIO pio, uint sm, const double* desenho, int frame_index) {
  uint32_t valor_led;
  
  for (int16_t i = 0; i < MTX_NUM_LEDS; i++) {
    int index = 24 - i;
    double pixel = desenho[index];

    valor_led = matrix_rgb(0.0, pixel,0.0);
    pio_sm_put_blocking(pio, sm, valor_led);
  }
}
